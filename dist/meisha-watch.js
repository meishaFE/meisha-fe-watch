!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MeishaWatch=e():t.MeishaWatch=e()}(window,function(){navigator.userAgent.toLowerCase().match(/MicroMessenger/i),navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),navigator.userAgent.match(/Android/i),/127.0.0.1|192.168|localhost/.test(window.location.host);function t(){this.settings={isReport:!0,reportURL:"",projectId:"",outTime:1e3},this.__logs=[],this.user="",this.uniqueId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),this.timer=null,this.reportTimes=0,this.isFirstReport=!0,Object.defineProperty(this,"logs",{value:[],configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(this,"logs",{get:function(){return this.__logs},set:function(t){(this.__logs=t).length&&this.checkLogs()}}),this.agentConsole(),this.agentAJAX(),this.configSender(),this.configListener();try{var t=JSON.parse(window.localStorage.getItem("_msLogs"));this.isArray(t)&&(this.logs=t)}catch(t){}}function a(t){var e=t.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),o=t.toString();return e.indexOf(o)<0&&(e=o+"@"+e),e}function u(t){var e="";for(var o in t)t.hasOwnProperty(o)&&(e+="&"+o+"="+t[o]);return e.slice(1)}function y(t,e,o,n,r,i,s){void 0===n&&(n=!0);var a=!1,c=new XMLHttpRequest,p=setTimeout(function(){a=!0,c.abort()},s);c.onreadystatechange=function(){a||(clearTimeout(p),4===c.readyState&&(200===c.status?r:i)(JSON.parse(c.responseText)))},c.open(e,"GET"===e.toUpperCase()?t+"?"+u(o):t,n),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(u(o))}function w(t,e){return("Number"!==e||!Number.isNaN(t))&&toString.call(t).replace(/.*\s(.*)]$/,"$1")===e}function v(t,i){var s=new WeakMap;return function o(e,n){var t,r;return void 0!==i&&(e=i(e)),"object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String?e:void 0!==(t=s.get(e))?{$ref:t}:(s.set(e,n),Array.isArray(e)?r=e.map(function(t,e){return o(t,n+"["+e+"]")}):(r={},Object.getOwnPropertyNames(e).forEach(function(t){r[t]=o(e[t],n+"["+t+"]")})),r)}(t,"$")}function c(t){window.localStorage&&t.length&&window.localStorage.setItem("_msLogs",JSON.stringify(t))}return new(t.prototype.init=function(t){this.settings=t},t.prototype.agentConsole=function(){var r=this;["error"].forEach(function(o){var n=console[o];console[o]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length&&"[MeishaWatch Console]"!==t[0]&&(r.logs=r.logs.concat([{msg:t.map(function(t){return"object"==typeof t?JSON.stringify(v(t,void 0)):t}).join(","),url:encodeURIComponent(window.location.href),type:o}]),c(r.logs)),n.apply(console,t)}})},t.prototype.agentAJAX=function(){var i=this,s=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var t=this,e=[].slice.call(arguments),o=e[0],n=e[1],r=t.onreadystatechange||function(){};return t.onreadystatechange=function(){return 4===t.readyState&&400<=t.status&&(i.logs=i.logs.concat([{msg:o+" "+n+" "+t.status,url:encodeURIComponent(window.location.href),type:"error"}])),r.apply(t,arguments)},s.apply(t,e)}},t.prototype.configListener=function(){var s=this;window.onerror=function(t,e,o,n,r){var i=t;r&&r.stack&&(i=a(r)),s.logs=s.logs.concat([{msg:encodeURIComponent(i.substr(0,500)),url:encodeURIComponent(window.location.href),type:"error",line:o,col:n}]),c(s.logs)}},t.prototype.configSender=function(){var t=this;window.addEventListener("load",function(){t.report(!0)},!1)},t.prototype.setUser=function(t){this.user=t},t.prototype.report=function(t){var e=this;if(void 0===t&&(t=!0),this.settings){var o=this.settings,n=o.reportURL,r=o.projectId,i=o.isReport,s=void 0===i||i,a=o.outTime;if(s&&this.reportTimes<20&&n&&r){var c=window.performance,p={dns:-1,tcp:-1,ttfb:-1,trans:-1,dom:-1,res:-1,firstbyte:-1,fpt:-1,tti:-1,ready:-1,load:-1};if(c){var u=c.timing;p.dns=u.domainLookupEnd-u.domainLookupStart,p.tcp=u.connectEnd-u.connectStart,p.ttfb=u.responseStart-u.requestStart,p.trans=u.responseEnd-u.responseStart,p.dom=u.domInteractive-u.responseEnd,p.res=u.loadEventStart-u.domContentLoadedEventEnd,p.firstbyte=u.responseStart-u.domainLookupStart,p.fpt=u.responseEnd-u.fetchStart,p.tti=u.domInteractive-u.fetchStart,p.ready=u.domContentLoadedEventEnd-u.fetchStart,p.load=u.loadEventStart-u.fetchStart}var l=w(this.user,"Number")||w(this.user,"String")?this.user:JSON.stringify(this.user),d=JSON.stringify(v(this.logs.slice(),void 0)),f=window.location.host,g=window.location.pathname,h=window.navigator&&window.navigator.userAgent,m={project:r,httpHost:f,requestUri:g,logs:d,user:l,uniqueId:this.uniqueId,ua:h};this.isFirstReport&&(m.times=JSON.stringify(p),this.isFirstReport=!1);try{y(n,"POST",m,t,function(){e.logs=[],window.localStorage&&window.localStorage.removeItem("_msLogs")},function(){},a)}catch(t){}finally{this.reportTimes++}}}},t.prototype.reportPageTime=function(t,e){if(this.settings){var o=this.settings,n=o.reportURL,r=o.projectId,i=o.isReport;if((void 0===i||i)&&n&&r){var s=w(this.user,"Number")||w(this.user,"String")?this.user:JSON.stringify(this.user),a=window.location.host,c=window.location.pathname,p=window.navigator&&window.navigator.userAgent,u=JSON.stringify({pageName:t,pageTime:e});try{y(n,"POST",{project:r,httpHost:a,requestUri:c,user:s,uniqueId:this.uniqueId,ua:p,pageParams:u},!0,function(){},function(){},0)}catch(t){}}}},t.prototype.useVue=function(){var r=this;return{install:function(t){var e=t.version&&t.version.split(".")||[];2<=+e[0]&&2<=+e[1]&&(t.config.errorHandler=function(t,e,o){console.error("[MeishaWatch Console]",t);var n=t?t.stack?a(t):t:"";o&&(n="[Info: "+o+"]->"+n),e&&e.$options&&e.$options.name&&(n="[Component Name: "+e.$options.name+"]->"+n),r.logs=r.logs.concat([{msg:n,url:encodeURIComponent(window.location.href),type:"error"}]),c(r.logs)}),function(t){var e=window.location.search.substr(1).match(new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"));return e?decodeURI(e[2]):""}("devtools")&&(t.config.devtools=!0)}}},t.prototype.checkLogs=function(){clearTimeout(this.timer),5<=this.logs.length?this.report():this.timer=setTimeout(this.report,3e3)},t.prototype.isArray=function(t){return"Array"===Object.prototype.toString.call(t).slice(8,-1)},t)});