!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MeishaWatch=e():t.MeishaWatch=e()}(window,function(){var r={wechat:!!navigator.userAgent.toLowerCase().match(/MicroMessenger/i),iOS:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Android:!!navigator.userAgent.match(/Android/i),dev:/127.0.0.1|192.168|localhost/.test(window.location.host)};function a(t){var e=t.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),o=t.toString();return e.indexOf(o)<0&&(e=o+"@"+e),e}function f(t){var e="";for(var o in t)t.hasOwnProperty(o)&&(e+="&"+o+"="+t[o]);return e.slice(1)}function h(t,e){return("Number"!==e||!Number.isNaN(t))&&toString.call(t).replace(/.*\s(.*)]$/,"$1")===e}function g(t,r){var s=new WeakMap;return function o(e,n){var t,i;return void 0!==r&&(e=r(e)),"object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String?e:void 0!==(t=s.get(e))?{$ref:t}:(s.set(e,n),Array.isArray(e)?i=e.map(function(t,e){return o(t,n+"["+e+"]")}):(i={},Object.keys(e).forEach(function(t){i[t]=o(e[t],n+"["+t+"]")})),i)}(t,"$")}return new(function(){function t(){this.settings={isReport:!0,reportURL:"",projectId:"",outTime:1e3,partitionId:""},this.__logs=[],this.user="",this.uniqueId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,o="x"===t?e:3&e|8;return o.toString(16)}),this.timer=null,this.reportTimes=0,r.iOS?(Object.defineProperty(this,"logs",{value:[],configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(this,"logs",{get:function(){return this.__logs},set:function(t){(this.__logs=t).length&&this.checkLogs()}})):this.logs=[],this.agentConsole(),this.agentAJAX(),this.configSender(),this.configListener()}return t.prototype.init=function(t){this.settings=t},t.prototype.agentConsole=function(){var i=this;["log","info","warn","debug","error"].forEach(function(o){var n=console[o];console[o]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length&&"[MeishaWatch Console]"!==t[0]&&(i.logs=i.logs.concat([{msg:t.map(function(t){return"object"==typeof t?JSON.stringify(g(t,void 0)):t}).join(","),url:window.location.href,type:o}])),n.apply(console,t)}})},t.prototype.agentAJAX=function(){var r=this,s=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){var t=this,e=[].slice.call(arguments),o=e[0],n=e[1],i=t.onreadystatechange||function(){};return t.onreadystatechange=function(){return 4===t.readyState&&400<=t.status&&(r.logs=r.logs.concat([{msg:o+" "+n+" "+t.status,url:window.location.href,type:"error"}])),i.apply(t,arguments)},s.apply(t,e)}},t.prototype.configListener=function(){var s=this;window.onerror=function(t,e,o,n,i){var r=t;i&&i.stack&&(r=a(i)),s.logs=s.logs.concat([{msg:r.substr(0,500),url:window.location.href,type:"error",line:o,col:n}])}},t.prototype.configSender=function(){var t=this;if(r.iOS&&window.addEventListener("load",function(){t.report(!0)},!1),window.addEventListener("unload",function(){t.report(!1)},!1),r.wechat&&r.Android){var e="hidden";e in document?document.addEventListener("visibilitychange",function(){document[e]&&t.report(!1)},!1):(e="webkitHidden")in document&&document.addEventListener("webkitvisibilitychange",function(){document[e]&&t.report(!1)},!1)}},t.prototype.setUser=function(t){this.user=t},t.prototype.report=function(t){if(void 0===t&&(t=!0),this.settings){var e=this.settings,o=e.reportURL,n=e.projectId,i=e.partitionId,r=e.isReport,s=void 0===r||r,a=e.outTime;if(s&&this.reportTimes<20&&o&&n&&i){var c=window.performance,u={loadPage:-1,domReady:-1,loadRes:-1};if(c){var p=c.timing;u.loadPage=p.loadEventEnd-p.navigationStart,u.domReady=p.domComplete-p.responseEnd,u.loadRes=p.responseEnd-p.requestStart}var d=h(this.user,"Number")||h(this.user,"String")?this.user:JSON.stringify(this.user),l=JSON.stringify(g(this.logs.slice(),void 0));this.logs=[];try{!function(t,e,o,n,i,r,s){void 0===n&&(n=!0);var a=!1,c=new XMLHttpRequest,u=setTimeout(function(){a=!0,c.abort()},s);c.onreadystatechange=function(){a||(clearTimeout(u),4===c.readyState&&(200===c.status?i:r)(JSON.parse(c.responseText)))},c.open(e,"GET"===e.toUpperCase()?t+"?"+f(o):t,n),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(f(o))}(o,"POST",{projectId:n,partitionId:i,logs:l,times:JSON.stringify(u),user:d,uniqueId:this.uniqueId},t,function(){},function(){},a)}catch(t){}finally{this.reportTimes++}}}},t.prototype.useVue=function(){var i=this;return{install:function(t){var e,o,n=t.version&&t.version.split(".")||[];2<=+n[0]&&2<=+n[1]&&(t.config.errorHandler=function(t,e,o){r.dev&&console.error("[MeishaWatch Console]",t);var n=t?t.stack?a(t):t:"";o&&(n="[Info: "+o+"]->"+n),e&&e.$options&&e.$options.name&&(n="[Component Name: "+e.$options.name+"]->"+n),i.logs=i.logs.concat([{msg:n,url:window.location.href,type:"error"}])}),e="devtools",(o=window.location.search.substr(1).match(new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i")))&&decodeURI(o[2])&&(t.config.devtools=!0)}}},t.prototype.checkLogs=function(){clearTimeout(this.timer),10<=this.logs.length?this.report():this.timer=setTimeout(this.report,3e3)},t}())});